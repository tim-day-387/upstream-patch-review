<html lang="en">
<body>
<pre>
LU-17240 tests: format and mount targets in parallel

Format and mount targets (OSTs and MDTs) in parallel.
This will make it much quicker to setup a test
cluster or single node test instance. For individual
developers, this is most notable by running the
llmount.sh script with a large OSTCOUNT or MDSCOUNT.

When formatting in parallel, the dm-flakey device
mapper targets must be cleaned up before mkfs.lustre
runs, otherwise mkfs.lustre will fail with "device is
apparently in use by the system". This is fixed by
setting CLEANUP_DM_DEV=true in formatall() before
calling stopall.

The parallel functionality is gated behind the
PARALLEL_MOUNT_OPS variable, which defaults to 0
(serial behavior). Setting PARALLEL_MOUNT_OPS=1
enables parallel formatting and mounting.

This also fixes mdsdevname(), ostdevname(), and
mgsdevname() to return the actual mounted device from
/proc/mounts when the device is mounted. This is needed
for debugfs access when dm-flakey or other device
mapper layers are enabled, as the logical device name
differs from the actual mounted device. This also fixes
a circular dependency bug in mgsdevname() where it
would call facet_mntpt(), which calls combined_mgs_mds(),
which calls mgsdevname(), creating an infinite loop.

Test-Parameters: testlist=sanity mdscount=2 mdtcount=4 fortestonly
Test-Parameters: testlist=conf-sanity mdscount=2 mdtcount=4 fortestonly
Signed-off-by: Timothy Day <timday@amazon.com>
Signed-off-by: Patrick Farrell <pfarrell@whamcloud.com>
Change-Id: I51af959a4f20644d9bd5166c1c1c8ebcfbef69f3

</pre>
</body>
</html>
