<html lang="en">
<body>
<pre>
From 065d1cb85c4d5acb3a1deeed78d0bc5084bd7148 Mon Sep 17 00:00:00 2001
From: Alex Deiter <adeiter@ddn.com>
Date: Mon, 27 Oct 2025 14:17:48 +0400
Subject: [PATCH 1/1] LU-19523 ldiskfs: fix format errors on RHEL8 aarch64
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

This patch fixes build errors on RHEL8 aarch64:
ldiskfs/mballoc.c: In function ‘ldiskfs_seq_mb_stats_show’:
ldiskfs/mballoc.c:3091:32: error: format ‘%llu’ expects argument of type
‘long long unsigned int’, but argument 3 has type ‘long int’ [-Werror=format=]
  seq_printf(seq, "\t\thits: %llu\n", atomic64_read(&sbi->s_bal_cX_hits[0]));
                             ~~~^
                             %lu

Test-Parameters: trivial clientarch=aarch64 clientdistro=el8.9
Change-Id: Ie5c19df8c12fd90380da84bfae781bbe5cbb3ee4
Signed-off-by: Alex Deiter <adeiter@ddn.com>
---
 .../ext4-add-mballoc-stats-proc-file.patch    | 28 +++++++++----------
 ...k-convert-protected-fields-to-atomic.patch |  4 +--
 .../ext4-improve-cr0-cr1-group-scanning.patch | 12 ++++----
 3 files changed, 22 insertions(+), 22 deletions(-)

diff --git a/ldiskfs/kernel_patches/patches/rhel8.8/ext4-add-mballoc-stats-proc-file.patch b/ldiskfs/kernel_patches/patches/rhel8.8/ext4-add-mballoc-stats-proc-file.patch
index bc5492bef7..0012f99b89 100644
--- a/ldiskfs/kernel_patches/patches/rhel8.8/ext4-add-mballoc-stats-proc-file.patch
+++ b/ldiskfs/kernel_patches/patches/rhel8.8/ext4-add-mballoc-stats-proc-file.patch
@@ -138,32 +138,32 @@ Index: linux-stage/fs/ext4/mballoc.c
 +	seq_printf(seq, "\tgroups_scanned: %u\n",  atomic_read(&sbi->s_bal_groups_scanned));
 +
 +	seq_puts(seq, "\tcr0_stats:\n");
-+	seq_printf(seq, "\t\thits: %llu\n", atomic64_read(&sbi->s_bal_cX_hits[0]));
++	seq_printf(seq, "\t\thits: %llu\n", (unsigned long long)atomic64_read(&sbi->s_bal_cX_hits[0]));
 +	seq_printf(seq, "\t\tgroups_considered: %llu\n",
-+		   atomic64_read(&sbi->s_bal_cX_groups_considered[0]));
++		   (unsigned long long)atomic64_read(&sbi->s_bal_cX_groups_considered[0]));
 +	seq_printf(seq, "\t\tuseless_loops: %llu\n",
-+		   atomic64_read(&sbi->s_bal_cX_failed[0]));
++		   (unsigned long long)atomic64_read(&sbi->s_bal_cX_failed[0]));
 +
 +	seq_puts(seq, "\tcr1_stats:\n");
-+	seq_printf(seq, "\t\thits: %llu\n", atomic64_read(&sbi->s_bal_cX_hits[1]));
++	seq_printf(seq, "\t\thits: %llu\n", (unsigned long long)atomic64_read(&sbi->s_bal_cX_hits[1]));
 +	seq_printf(seq, "\t\tgroups_considered: %llu\n",
-+		   atomic64_read(&sbi->s_bal_cX_groups_considered[1]));
++		   (unsigned long long)atomic64_read(&sbi->s_bal_cX_groups_considered[1]));
 +	seq_printf(seq, "\t\tuseless_loops: %llu\n",
-+		   atomic64_read(&sbi->s_bal_cX_failed[1]));
++		   (unsigned long long)atomic64_read(&sbi->s_bal_cX_failed[1]));
 +
 +	seq_puts(seq, "\tcr2_stats:\n");
-+	seq_printf(seq, "\t\thits: %llu\n", atomic64_read(&sbi->s_bal_cX_hits[2]));
++	seq_printf(seq, "\t\thits: %llu\n", (unsigned long long)atomic64_read(&sbi->s_bal_cX_hits[2]));
 +	seq_printf(seq, "\t\tgroups_considered: %llu\n",
-+		   atomic64_read(&sbi->s_bal_cX_groups_considered[2]));
++		   (unsigned long long)atomic64_read(&sbi->s_bal_cX_groups_considered[2]));
 +	seq_printf(seq, "\t\tuseless_loops: %llu\n",
-+		   atomic64_read(&sbi->s_bal_cX_failed[2]));
++		   (unsigned long long)atomic64_read(&sbi->s_bal_cX_failed[2]));
 +
 +	seq_puts(seq, "\tcr3_stats:\n");
-+	seq_printf(seq, "\t\thits: %llu\n", atomic64_read(&sbi->s_bal_cX_hits[3]));
++	seq_printf(seq, "\t\thits: %llu\n", (unsigned long long)atomic64_read(&sbi->s_bal_cX_hits[3]));
 +	seq_printf(seq, "\t\tgroups_considered: %llu\n",
-+		   atomic64_read(&sbi->s_bal_cX_groups_considered[3]));
++		   (unsigned long long)atomic64_read(&sbi->s_bal_cX_groups_considered[3]));
 +	seq_printf(seq, "\t\tuseless_loops: %llu\n",
-+		   atomic64_read(&sbi->s_bal_cX_failed[3]));
++		   (unsigned long long)atomic64_read(&sbi->s_bal_cX_failed[3]));
 +	seq_printf(seq, "\textents_scanned: %u\n", atomic_read(&sbi->s_bal_ex_scanned));
 +	seq_printf(seq, "\t\tgoal_hits: %u\n", atomic_read(&sbi->s_bal_goals));
 +	seq_printf(seq, "\t\t2^n_hits: %u\n", atomic_read(&sbi->s_bal_2orders));
@@ -174,7 +174,7 @@ Index: linux-stage/fs/ext4/mballoc.c
 +		   atomic_read(&sbi->s_mb_buddies_generated),
 +		   ext4_get_groups_count(sb));
 +	seq_printf(seq, "\tbuddies_time_used: %llu\n",
-+		   atomic64_read(&sbi->s_mb_generation_time));
++		   (unsigned long long)atomic64_read(&sbi->s_mb_generation_time));
 +	seq_printf(seq, "\tpreallocated: %u\n",
 +		   atomic_read(&sbi->s_mb_preallocated));
 +	seq_printf(seq, "\tdiscarded: %u\n",
@@ -223,7 +223,7 @@ Index: linux-stage/fs/ext4/mballoc.c
 -	seq_printf(seq, "\tbuddies_generated: %u\n",
 -		   atomic_read(&sbi->s_mb_buddies_generated));
 -	seq_printf(seq, "\tbuddies_time_used: %llu\n",
--		   atomic64_read(&sbi->s_mb_generation_time));
+-		   (unsigned long long)atomic64_read(&sbi->s_mb_generation_time));
 -	seq_printf(seq, "\tpreallocated: %u\n",
 -		   atomic_read(&sbi->s_mb_preallocated));
 -	seq_printf(seq, "\tdiscarded: %u\n",
diff --git a/ldiskfs/kernel_patches/patches/rhel8.8/ext4-drop-s_mb_bal_lock-convert-protected-fields-to-atomic.patch b/ldiskfs/kernel_patches/patches/rhel8.8/ext4-drop-s_mb_bal_lock-convert-protected-fields-to-atomic.patch
index d029ee1cdd..68cd52e190 100644
--- a/ldiskfs/kernel_patches/patches/rhel8.8/ext4-drop-s_mb_bal_lock-convert-protected-fields-to-atomic.patch
+++ b/ldiskfs/kernel_patches/patches/rhel8.8/ext4-drop-s_mb_bal_lock-convert-protected-fields-to-atomic.patch
@@ -64,7 +64,7 @@ Index: linux-stage/fs/ext4/mballoc.c
 +	seq_printf(seq, "\tbuddies_generated: %u\n",
 +		   atomic_read(&sbi->s_mb_buddies_generated));
 +	seq_printf(seq, "\tbuddies_time_used: %llu\n",
-+		   atomic64_read(&sbi->s_mb_generation_time));
++		   (unsigned long long)atomic64_read(&sbi->s_mb_generation_time));
  	seq_printf(seq, "\tpreallocated: %u\n",
  		   atomic_read(&sbi->s_mb_preallocated));
  	seq_printf(seq, "\tdiscarded: %u\n",
@@ -96,7 +96,7 @@ Index: linux-stage/fs/ext4/mballoc.c
 -				sbi->s_mb_generation_time);
 +		       "mballoc: %u generated and it took %Lu",
 +				atomic_read(&sbi->s_mb_buddies_generated),
-+				atomic64_read(&sbi->s_mb_generation_time));
++				(unsigned long long)atomic64_read(&sbi->s_mb_generation_time));
  		ext4_msg(sb, KERN_INFO,
  		       "mballoc: %u preallocated, %u discarded",
  				atomic_read(&sbi->s_mb_preallocated),
diff --git a/ldiskfs/kernel_patches/patches/rhel8.8/ext4-improve-cr0-cr1-group-scanning.patch b/ldiskfs/kernel_patches/patches/rhel8.8/ext4-improve-cr0-cr1-group-scanning.patch
index 8c2f5ca3fa..2cf1990e6e 100644
--- a/ldiskfs/kernel_patches/patches/rhel8.8/ext4-improve-cr0-cr1-group-scanning.patch
+++ b/ldiskfs/kernel_patches/patches/rhel8.8/ext4-improve-cr0-cr1-group-scanning.patch
@@ -591,23 +591,23 @@ Index: linux-stage/fs/ext4/mballoc.c
  			/*
  			 * Batch reads of the block allocation bitmaps
 @@ -2651,6 +2992,8 @@ int ext4_seq_mb_stats_show(struct seq_fi
- 		   atomic64_read(&sbi->s_bal_cX_groups_considered[0]));
+ 		   (unsigned long long)atomic64_read(&sbi->s_bal_cX_groups_considered[0]));
  	seq_printf(seq, "\t\tuseless_loops: %llu\n",
- 		   atomic64_read(&sbi->s_bal_cX_failed[0]));
+ 		   (unsigned long long)atomic64_read(&sbi->s_bal_cX_failed[0]));
 +	seq_printf(seq, "\t\tbad_suggestions: %u\n",
 +		   atomic_read(&sbi->s_bal_cr0_bad_suggestions));
  
  	seq_puts(seq, "\tcr1_stats:\n");
- 	seq_printf(seq, "\t\thits: %llu\n", atomic64_read(&sbi->s_bal_cX_hits[1]));
+ 	seq_printf(seq, "\t\thits: %llu\n", (unsigned long long)atomic64_read(&sbi->s_bal_cX_hits[1]));
 @@ -2658,6 +3001,8 @@ int ext4_seq_mb_stats_show(struct seq_fi
- 		   atomic64_read(&sbi->s_bal_cX_groups_considered[1]));
+ 		   (unsigned long long)atomic64_read(&sbi->s_bal_cX_groups_considered[1]));
  	seq_printf(seq, "\t\tuseless_loops: %llu\n",
- 		   atomic64_read(&sbi->s_bal_cX_failed[1]));
+ 		   (unsigned long long)atomic64_read(&sbi->s_bal_cX_failed[1]));
 +	seq_printf(seq, "\t\tbad_suggestions: %u\n",
 +		   atomic_read(&sbi->s_bal_cr1_bad_suggestions));
  
  	seq_puts(seq, "\tcr2_stats:\n");
- 	seq_printf(seq, "\t\thits: %llu\n", atomic64_read(&sbi->s_bal_cX_hits[2]));
+ 	seq_printf(seq, "\t\thits: %llu\n", (unsigned long long)atomic64_read(&sbi->s_bal_cX_hits[2]));
 @@ -2945,8 +3290,11 @@ int ext4_mb_add_groupinfo(struct super_b
  	INIT_LIST_HEAD(&meta_group_info[i]->bb_prealloc_list);
  	init_rwsem(&meta_group_info[i]->alloc_sem);

</pre>
</body>
</html>
