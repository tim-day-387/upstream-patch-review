<html lang="en">
<body>
<pre>
LU-15127 osc: Resource cleanup in osc invalidate

There is a race condition whereby an LDLM lock can escape
cancellation in the first pass of ldlm_namespace_cleanup
and be matched by a new i/o.  This can cause a hang in
osc_object_invalidate, as the new i/o will never complete
because it's waiting for the LDLM lock.

The solution tried here is calling cleanup on that resource
from osc_object_invalidate.  It should not be possible for
any further i/os to match the waiting lock at this point,
so cancellation here should complete the lock and any i/os
waiting on it.

Note also that the issue here is specifically an i/o
which cannot proceed because the lock has not been granted,
so the lock cannot be covering any pages.  This means we
don't have the circular problem where a lock cannot be
cancelled until the pages are freed (by OSC invalidation),
because the lock in question cannot be covering any
pages.

Signed-off-by: Patrick Farrell <pfarrell@whamcloud.com>
Change-Id: I794eeecc198f8b02c8dbaf5c69088188d7d40d9f

</pre>
</body>
</html>
