<html lang="en">
<body>
<pre>
From 327a942c7df0efd56fb8eb8b1c117bc45887acb9 Mon Sep 17 00:00:00 2001
From: Brian Behlendorf <behlendorf1@llnl.gov>
Date: Wed, 29 Oct 2025 11:23:53 -0700
Subject: [PATCH 1/1] LU-19539 osd-zfs: use osd_dmu_write() wrapper for xattrs

When setting xattrs use the osd_dmu_write() wrapper which is
internally calls the _by_dnode() version of dmu_write().  This
both avoids an extra lookup and hold on the dnode, and removes
the osd-zfs dependency on the dmu_write() symbol which adds an
argument in ZFS 2.4.

Signed-off-by: Brian Behlendorf <behlendorf1@llnl.gov>
Change-Id: I30ba7abbcf0eefb3dee01b4061baaace2d971842
---
 lustre/osd-zfs/osd_xattr.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/lustre/osd-zfs/osd_xattr.c b/lustre/osd-zfs/osd_xattr.c
index ba57cf32a3..9325cdf0ac 100644
--- a/lustre/osd-zfs/osd_xattr.c
+++ b/lustre/osd-zfs/osd_xattr.c
@@ -770,7 +770,7 @@ __osd_xattr_set(const struct lu_env *env, struct osd_object *obj,
 	}
 
 	/* Finally write the xattr value */
-	dmu_write(osd->od_os, xa_data_obj, 0, buf->lb_len, buf->lb_buf, tx);
+	osd_dmu_write(osd, xa_data_dn, 0, buf->lb_len, buf->lb_buf, tx);
 
 	size = buf->lb_len;
 	rc = -sa_update(sa_hdl, SA_ZPL_SIZE(osd), &size, 8, tx);

</pre>
</body>
</html>
