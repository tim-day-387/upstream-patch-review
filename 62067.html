<html lang="en">
<body>
<pre>
From dcd9c71613490ae22c4cdbfdb762fc7233f344ef Mon Sep 17 00:00:00 2001
From: Jian Yu <yujian@whamcloud.com>
Date: Mon, 27 Oct 2025 14:56:17 -0700
Subject: [PATCH 1/1] LU-18667 lustre: replace egrep and fgrep

Starting from GNU grep version 3.8, egrep and fgrep are
warned as obsolescent and should be replaced by grep -E
and grep -F.

  # cat /usr/bin/egrep
  #!/usr/bin/sh
  cmd=${0##*/}
  echo "$cmd: warning: $cmd is obsolescent; using grep -E" >&2
  exec grep -E "$@"

  # cat /usr/bin/fgrep
  #!/usr/bin/sh
  cmd=${0##*/}
  echo "$cmd: warning: $cmd is obsolescent; using grep -F" >&2
  exec grep -F "$@"

This patch replaces egrep and fgrep in Lustre codes to
eliminate the warnings.

Change-Id: I7984125a338b0c3a668fe4a1564280b8652fe75f
Signed-off-by: Jian Yu <yujian@whamcloud.com>
---
 config/lustre-build-linux.m4             | 20 +++++++-------
 config/lustre-build-zfs.m4               |  4 +--
 config/lustre-lnet.m4                    |  4 +--
 contrib/lbuild/funcs.sh                  |  5 ++--
 contrib/lbuild/lbuild-rhel               |  2 +-
 contrib/lbuild/rhel10/rpmmacros.template |  2 +-
 contrib/lbuild/rhel9/rpmmacros.template  |  2 +-
 contrib/scripts/confirmpatches.sh        |  2 +-
 contrib/scripts/updatecw.sh              | 11 ++++----
 lustre/conf/resource/healthLNET          |  2 +-
 lustre/osd-ldiskfs/osd_iam_lvar.c        |  2 +-
 lustre/scripts/lc_common                 |  4 +--
 lustre/scripts/lc_lvm.in                 |  2 +-
 lustre/scripts/lc_md.in                  |  4 +--
 lustre/scripts/lc_net.in                 |  2 +-
 lustre/scripts/lc_servip                 |  2 +-
 lustre/scripts/lnet.in                   |  2 +-
 lustre/scripts/lustre                    |  2 +-
 lustre/scripts/lustre_req_history        |  2 +-
 lustre/tests/conf-sanity.sh              | 10 +++----
 lustre/tests/dom-performance.sh          |  2 +-
 lustre/tests/ost-pools.sh                |  2 +-
 lustre/tests/posix/posix.cfg             |  4 +--
 lustre/tests/racer/file_exec.sh          |  2 +-
 lustre/tests/recovery-small.sh           |  5 ++--
 lustre/tests/sanity-hsm.sh               |  2 +-
 lustre/tests/sanity-lnet.sh              |  8 +++---
 lustre/tests/sanity.sh                   | 33 ++++++++++++------------
 lustre/tests/sanityn.sh                  |  6 +++--
 lustre/tests/setup_kerberos.sh           |  3 ++-
 lustre/tests/test-framework.sh           | 14 +++++-----
 31 files changed, 87 insertions(+), 80 deletions(-)

diff --git a/config/lustre-build-linux.m4 b/config/lustre-build-linux.m4
index a85c9c581b..db9af60125 100644
--- a/config/lustre-build-linux.m4
+++ b/config/lustre-build-linux.m4
@@ -75,11 +75,11 @@ lb_cv_utsrelease=""
 utsrelease1=$LINUX_OBJ/include/generated/utsrelease.h
 utsrelease2=$LINUX_OBJ/include/linux/utsrelease.h
 utsrelease3=$LINUX_OBJ/include/linux/version.h
-AS_IF([test -r $utsrelease1 && fgrep -q UTS_RELEASE $utsrelease1],
+AS_IF([test -r $utsrelease1 && grep -F -q UTS_RELEASE $utsrelease1],
 	[utsrelease=$utsrelease1],
-[test -r $utsrelease2 && fgrep -q UTS_RELEASE $utsrelease2],
+[test -r $utsrelease2 && grep -F -q UTS_RELEASE $utsrelease2],
 	[utsrelease=$utsrelease2],
-[test -r $utsrelease3 && fgrep -q UTS_RELEASE $utsrelease3],
+[test -r $utsrelease3 && grep -F -q UTS_RELEASE $utsrelease3],
 	[utsrelease=$utsrelease3])
 AS_IF([test -n "$utsrelease"],
 	[lb_cv_utsrelease=$(awk -F \" '/ UTS_RELEASE / { print [$]2 }' $utsrelease)],
@@ -117,7 +117,7 @@ AC_DEFUN([LB_LINUX_RELEASE], [
 	# Check for RedHat first (no need to check KERNEL_FOUND
 	AC_CACHE_CHECK([for RedHat kernel release number], lb_cv_rhel_kernel_version, [
 		lb_cv_rhel_kernel_version=""
-		AS_IF([fgrep -q RHEL_RELEASE $LINUX_OBJ/include/$VERSION_HDIR/version.h], [
+		AS_IF([grep -F -q RHEL_RELEASE $LINUX_OBJ/include/$VERSION_HDIR/version.h], [
 			lb_cv_rhel_kernel_version=$(awk '/ RHEL_MAJOR / { print [$]3 }' \
 				$LINUX_OBJ/include/$VERSION_HDIR/version.h)$(awk \
 				'/ RHEL_MINOR / { print [$]3 }' \
@@ -146,7 +146,7 @@ AC_DEFUN([LB_LINUX_RELEASE], [
 	AS_IF([test "x$KERNEL_FOUND" = "xno"], [
 		AC_CACHE_CHECK([for Ubuntu kernel signature], lb_cv_ubuntu_kernel_sig, [
 			lb_cv_ubuntu_kernel_sig="no"
-			AS_IF([fgrep -q "UTS_UBUNTU_RELEASE_ABI" $LINUX_OBJ/include/generated/utsrelease.h], [
+			AS_IF([grep -F -q "UTS_UBUNTU_RELEASE_ABI" $LINUX_OBJ/include/generated/utsrelease.h], [
 				lb_cv_ubuntu_kernel_sig="yes"
 			])
 		])
@@ -174,13 +174,13 @@ AC_DEFUN([LB_LINUX_RELEASE], [
 		AC_CACHE_CHECK([for ELRepo -ml kernel signature on CentOS],
 				lb_cv_mainline_kernel_sig, [
 			lb_cv_mainline_kernel_sig="no"
-			AS_IF([fgrep -q '.el7.' $LINUX_OBJ/include/generated/utsrelease.h], [
+			AS_IF([grep -F -q '.el7.' $LINUX_OBJ/include/generated/utsrelease.h], [
 				lb_cv_mainline_kernel_sig="yes"
 			])
-			AS_IF([fgrep -q '.el8.' $LINUX_OBJ/include/generated/utsrelease.h], [
+			AS_IF([grep -F -q '.el8.' $LINUX_OBJ/include/generated/utsrelease.h], [
 				lb_cv_mainline_kernel_sig="yes"
 			])
-			AS_IF([fgrep -q '.el9.' $LINUX_OBJ/include/generated/utsrelease.h], [
+			AS_IF([grep -F -q '.el9.' $LINUX_OBJ/include/generated/utsrelease.h], [
 				lb_cv_mainline_kernel_sig="yes"
 			])
 		])
@@ -194,7 +194,7 @@ AC_DEFUN([LB_LINUX_RELEASE], [
 	AS_IF([test "x$KERNEL_FOUND" = "xno"], [
 		AC_CACHE_CHECK([for openEuler kernel version number], lb_cv_openeuler_kernel_version, [
 			lb_cv_openeuler_kernel_version=""
-			AS_IF([fgrep -q OPENEULER_VERSION $LINUX_OBJ/include/$VERSION_HDIR/version.h], [
+			AS_IF([grep -F -q OPENEULER_VERSION $LINUX_OBJ/include/$VERSION_HDIR/version.h], [
 				lb_cv_openeuler_kernel_version=$(awk '/ OPENEULER_MAJOR / { print [$]3 }' \
 					$LINUX_OBJ/include/$VERSION_HDIR/version.h).$(awk \
 					'/ OPENEULER_MINOR / { print [$]3 }' \
@@ -542,7 +542,7 @@ LC_LBUG_WITH_LOC_IN_OBJTOOL
 AC_DEFUN([LB_USES_DPKG], [
 AC_CACHE_CHECK([if this distro uses dpkg], lb_cv_uses_dpkg, [
 lb_cv_uses_dpkg="no"
-AS_CASE([$(egrep -q 'ubuntu|debian' /etc/os-release && which dpkg 2>/dev/null)],
+AS_CASE([$(grep -E -q 'ubuntu|debian' /etc/os-release && which dpkg 2>/dev/null)],
         [*/dpkg], [lb_cv_uses_dpkg="yes"])
 ])
 uses_dpkg=$lb_cv_uses_dpkg
diff --git a/config/lustre-build-zfs.m4 b/config/lustre-build-zfs.m4
index d534d34e77..44cbd32232 100644
--- a/config/lustre-build-zfs.m4
+++ b/config/lustre-build-zfs.m4
@@ -154,7 +154,7 @@ AC_DEFUN([LB_SPL], [
 	#
 	AS_IF([test x$enable_zfs = xyes], [
 		AC_MSG_CHECKING([spl source version])
-		AS_IF([fgrep -q SPL_META_VERSION $splobj/spl_config.h], [
+		AS_IF([grep -F -q SPL_META_VERSION $splobj/spl_config.h], [
 			splver=$((echo "#include <spl_config.h>";
 			    echo "splver=SPL_META_VERSION-SPL_META_RELEASE") |
 			    cpp -I $splobj |
@@ -279,7 +279,7 @@ AC_DEFUN([LB_ZFS], [
 	#
 	AS_IF([test x$enable_zfs = xyes], [
 		AC_MSG_CHECKING([zfs source version])
-		AS_IF([fgrep -q ZFS_META_VERSION $zfsobj/zfs_config.h], [
+		AS_IF([grep -F -q ZFS_META_VERSION $zfsobj/zfs_config.h], [
 			zfsver=$((echo "#include <zfs_config.h>";
 			    echo "zfsver=ZFS_META_VERSION-ZFS_META_RELEASE") |
 			    cpp -I $zfsobj |
diff --git a/config/lustre-lnet.m4 b/config/lustre-lnet.m4
index 3c16434723..e9c26a92c9 100644
--- a/config/lustre-lnet.m4
+++ b/config/lustre-lnet.m4
@@ -99,7 +99,7 @@ case $with_o2ib in
 			O2IBDIR+="|/openib"
 
 			O2IBDIR_PATH=$(eval $LSPKG $O2IBPKG 2>/dev/null |
-				       egrep "${O2IBDIR}$" |
+				       grep -E "${O2IBDIR}$" |
 				       grep -v /ofed_scripts/ | head -n1)
 
 			# Nowadays, path should always be
@@ -888,7 +888,7 @@ AS_CASE([$enable_efa],
 
 		EFA_PKG="efa"
 		EFA_HEADER="efa_verbs.h"
-		EFA_HEADER_PATH=$(eval "$LS_PKG $EFA_PKG" | egrep "$EFA_HEADER" | head -n1)
+		EFA_HEADER_PATH=$(eval "$LS_PKG $EFA_PKG" | grep -E "$EFA_HEADER" | head -n1)
 		AS_IF([test -n "$EFA_HEADER_PATH"], [
 			EFA_INCLUDE_PATH=$(dirname $EFA_HEADER_PATH)
 		])
diff --git a/contrib/lbuild/funcs.sh b/contrib/lbuild/funcs.sh
index 1df32d6b98..fc4f79c97a 100644
--- a/contrib/lbuild/funcs.sh
+++ b/contrib/lbuild/funcs.sh
@@ -35,8 +35,9 @@ find_rpm() {
         fi
         case "$match_type" in
             provides)
-                # match is any valid ERE (i.e. given to egrep) match
-                if rpm -q --provides -p "$file" 2>&$STDOUT | egrep "$match" >&$STDOUT; then
+                # match is any valid ERE (i.e. given to grep -E) match
+                if rpm -q --provides -p "$file" 2>&$STDOUT |
+			grep -E "$match" >&$STDOUT; then
                     echo "$file"
                     popd >/dev/null
                     return 0
diff --git a/contrib/lbuild/lbuild-rhel b/contrib/lbuild/lbuild-rhel
index 41fda8c7b0..80c3cb86bc 100644
--- a/contrib/lbuild/lbuild-rhel
+++ b/contrib/lbuild/lbuild-rhel
@@ -9,7 +9,7 @@
 #BUILD_GEN+=".0"	# TT-107: don't cache the BUILD dir (reset major to 5)
 BUILD_GEN+=".2"	# LU-9850
 
-DISTROVER=$(echo "$DISTROMAJ" | egrep -o '[0-9]+')
+DISTROVER=$(echo "$DISTROMAJ" | grep -E -o '[0-9]+')
 if [[ ( "$TARGET_ARCH" =~ "aarch64" || "$TARGET_ARCH" =~ "arm64" ) ]] &&
    [[ ( "$TARGET_ARCH" =~ "64k" || $(getconf PAGE_SIZE) == 65536 ) ]] &&
    (( DISTROVER > 8 )); then
diff --git a/contrib/lbuild/rhel10/rpmmacros.template b/contrib/lbuild/rhel10/rpmmacros.template
index e44eb03f34..48938a213f 100644
--- a/contrib/lbuild/rhel10/rpmmacros.template
+++ b/contrib/lbuild/rhel10/rpmmacros.template
@@ -42,7 +42,7 @@
 	%global kmodtool %{-s*}%{!-s:REPLACE_ME} \
 	%global kmod_version %{-v*}%{!-v:%{version}} \
 	%global kmod_release %{-r*}%{!-r:%{release}} \
-	%global latest_kernel %({ rpm -q --qf '%%{VERSION}-%%{RELEASE}.%%{ARCH}\\\\n' `rpm -qa | egrep "^kernel(-rt|-aarch64)?-devel" | /usr/lib/rpm/redhat/rpmsort -r | head -n 1`; echo '%%%%{nil}'; } | head -n 1) \
+	%global latest_kernel %({ rpm -q --qf '%%{VERSION}-%%{RELEASE}.%%{ARCH}\\\\n' `rpm -qa | grep -E "^kernel(-rt|-aarch64)?-devel" | /usr/lib/rpm/redhat/rpmsort -r | head -n 1`; echo '%%%%{nil}'; } | head -n 1) \
 	%{!?kernel_version:%{expand:%%global kernel_version %{latest_kernel}}} \
 	%global kverrel %(%{kmodtool} verrel %{?kernel_version} 2>/dev/null) \
 	flavors="default" \
diff --git a/contrib/lbuild/rhel9/rpmmacros.template b/contrib/lbuild/rhel9/rpmmacros.template
index e44eb03f34..48938a213f 100644
--- a/contrib/lbuild/rhel9/rpmmacros.template
+++ b/contrib/lbuild/rhel9/rpmmacros.template
@@ -42,7 +42,7 @@
 	%global kmodtool %{-s*}%{!-s:REPLACE_ME} \
 	%global kmod_version %{-v*}%{!-v:%{version}} \
 	%global kmod_release %{-r*}%{!-r:%{release}} \
-	%global latest_kernel %({ rpm -q --qf '%%{VERSION}-%%{RELEASE}.%%{ARCH}\\\\n' `rpm -qa | egrep "^kernel(-rt|-aarch64)?-devel" | /usr/lib/rpm/redhat/rpmsort -r | head -n 1`; echo '%%%%{nil}'; } | head -n 1) \
+	%global latest_kernel %({ rpm -q --qf '%%{VERSION}-%%{RELEASE}.%%{ARCH}\\\\n' `rpm -qa | grep -E "^kernel(-rt|-aarch64)?-devel" | /usr/lib/rpm/redhat/rpmsort -r | head -n 1`; echo '%%%%{nil}'; } | head -n 1) \
 	%{!?kernel_version:%{expand:%%global kernel_version %{latest_kernel}}} \
 	%global kverrel %(%{kmodtool} verrel %{?kernel_version} 2>/dev/null) \
 	flavors="default" \
diff --git a/contrib/scripts/confirmpatches.sh b/contrib/scripts/confirmpatches.sh
index 7531aa1ca6..bc1caf4aa1 100755
--- a/contrib/scripts/confirmpatches.sh
+++ b/contrib/scripts/confirmpatches.sh
@@ -12,7 +12,7 @@ PATCHPATH=${PATCHPATH:-$BASEDIR/patches}
 [ ! -d "$SERIESPATH" ] && echo "$PROG: missing series '$SERIESPATH'" && exit 2
 [ ! -d "$PATCHPATH" ] && echo "$PROG: missing patches '$PATCHPATH'" && exit 3
 
-for SERIES in $(ls $SERIESPATH | egrep -v "~$|.orig|.rej") ; do
+for SERIES in $(ls $SERIESPATH | grep -E -v "~$|.orig|.rej") ; do
 	$VERBOSE "series: $SERIES"
 	for PATCH in $(grep -v "^#" $SERIESPATH/$SERIES); do
 		$VERBOSE $PATCH
diff --git a/contrib/scripts/updatecw.sh b/contrib/scripts/updatecw.sh
index 949eb749cb..27003b8eea 100755
--- a/contrib/scripts/updatecw.sh
+++ b/contrib/scripts/updatecw.sh
@@ -218,16 +218,16 @@ git ls-files $DIRS | while read FILE; do
 		continue ;;
 	esac
 
-	OLDCOPY=$(egrep "$INTCOPY" $FILE | tail -n1)
+	OLDCOPY=$(grep -E "$INTCOPY" $FILE | tail -n1)
 	# Skip files that already have a copyright for this year
-	[ -n "$(egrep -e $THISYEAR <<<"$OLDCOPY")" ] && continue
+	[ -n "$(grep -E -e $THISYEAR <<<"$OLDCOPY")" ] && continue
 
 	ADDCOPY=false
 	# Pick only files that have changed since $START
 	# %ai author dates holds has bad data, use %ci instead
 	# Exclude revert commits and the patch being reverted.
 	git log --follow --since=$START --pretty=format:"%ci %ae %H" $FILE |
-		grep -v -f $EXCFILE | egrep -e "$AUTHOR" |
+		grep -v -f $EXCFILE | grep -E -e "$AUTHOR" |
 		while read YYYY TTTT TZZZ AUTHOR HASH; do
 			REVERT=$(git show -s $HASH |
 				 awk '/This reverts commit/ { print $4 }')
@@ -243,7 +243,7 @@ git ls-files $DIRS | while read FILE; do
 	# Skip files not modified by $AUTHOR
 	[ -s "$TMPFILE" ] || continue
 
-	if [ -z "$(egrep -e "$OLDCOPY1" $FILE)" ]; then
+	if [ -z "$(grep -E -e "$OLDCOPY1" $FILE)" ]; then
 		case $FILE in
 		*.[ch])
 			echo "$FILE: ** NO COPYRIGHT. INSPECT  **"
@@ -255,7 +255,8 @@ git ls-files $DIRS | while read FILE; do
 
 	if [ -z "$(grep "$INTCOPY" <<<"$OLDCOPY")" ]; then
 		ADDCOPY=true
-		OLDCOPY="$(egrep "$OLDCOPY1|$OLDCOPY2" $FILE| tail -n1| tr / .)"
+		OLDCOPY="$(grep -E "$OLDCOPY1|$OLDCOPY2" $FILE |
+			   tail -n1 | tr / .)"
 	fi
 
 	# Get commit dates
diff --git a/lustre/conf/resource/healthLNET b/lustre/conf/resource/healthLNET
index 3bf9afe662..6ff432471d 100755
--- a/lustre/conf/resource/healthLNET
+++ b/lustre/conf/resource/healthLNET
@@ -333,7 +333,7 @@ ping_update() {
 : ${OCF_RESKEY_CRM_meta_timeout:="20000"}
 : ${OCF_RESKEY_CRM_meta_globally_unique:="true"}
 
-integer=`echo ${OCF_RESKEY_timeout} | egrep -o '[0-9]*'`
+integer=`echo ${OCF_RESKEY_timeout} | grep -E -o '[0-9]*'`
 case ${OCF_RESKEY_timeout} in
     *[0-9]ms|*[0-9]msec) OCF_RESKEY_timeout=`expr $integer / 1000`;;
     *[0-9]m|*[0-9]min) OCF_RESKEY_timeout=`expr $integer \* 60`;;
diff --git a/lustre/osd-ldiskfs/osd_iam_lvar.c b/lustre/osd-ldiskfs/osd_iam_lvar.c
index 77a9343511..5f1b583bf3 100644
--- a/lustre/osd-ldiskfs/osd_iam_lvar.c
+++ b/lustre/osd-ldiskfs/osd_iam_lvar.c
@@ -746,7 +746,7 @@ static const struct iam_leaf_operations lvar_leaf_ops = {
  */
 
 enum {
-	/* egrep -i '^o?x?[olabcdef]*$' /usr/share/dict/words */
+	/* grep -E -i '^o?x?[olabcdef]*$' /usr/share/dict/words */
 	IAM_LVAR_ROOT_MAGIC = 0xb01dface
 };
 
diff --git a/lustre/scripts/lc_common b/lustre/scripts/lc_common
index 386b380622..709a09cfa5 100755
--- a/lustre/scripts/lc_common
+++ b/lustre/scripts/lc_common
@@ -495,7 +495,7 @@ get_csv_nodelist() {
     # Check the CSV file
     ! check_file ${csv_file} 2>&1 && return 1
 
-    all_nodelist=$(egrep -v "([[:space:]]|^)#" ${csv_file} | cut -d, -f 1)
+    all_nodelist=$(grep -E -v "([[:space:]]|^)#" ${csv_file} | cut -d, -f 1)
     all_nodelist=$(comma_list ${all_nodelist})
 
     echo ${all_nodelist}
@@ -1004,7 +1004,7 @@ get_lustre_items() {
         [ -z "`echo ${LINE} | awk '/[[:alnum:]]/ {print $0}'`" ] && continue
 
         # Get rid of the comment line
-        [ -z "`echo \"${LINE}\" | egrep -v \"([[:space:]]|^)#\"`" ] && continue
+        [ -z "`echo \"${LINE}\" | grep -E -v \"([[:space:]]|^)#\"`" ] && continue
 
         # Skip the Linux MD/LVM line
         marker=$(echo ${LINE} | cut -d, -f 2)
diff --git a/lustre/scripts/lc_lvm.in b/lustre/scripts/lc_lvm.in
index 3f0d616a64..906d5de3a2 100644
--- a/lustre/scripts/lc_lvm.in
+++ b/lustre/scripts/lc_lvm.in
@@ -253,7 +253,7 @@ get_lvm_items() {
         let "line_num += 1"
 
         # Skip the comment line
-        [ -z "`echo \"${LINE}\" | egrep -v \"([[:space:]]|^)#\"`" ] && continue
+        [ -z "`echo \"${LINE}\" | grep -E -v \"([[:space:]]|^)#\"`" ] && continue
 
         # Skip the non-LVM line
         line_marker=$(echo ${LINE} | cut -d, -f 2)
diff --git a/lustre/scripts/lc_md.in b/lustre/scripts/lc_md.in
index 0790ebc4cf..36fe862deb 100644
--- a/lustre/scripts/lc_md.in
+++ b/lustre/scripts/lc_md.in
@@ -185,7 +185,7 @@ get_md_items() {
         let "line_num += 1"
 
         # Skip the comment line
-        [ -z "`echo \"${LINE}\" | egrep -v \"([[:space:]]|^)#\"`" ] && continue
+        [ -z "`echo \"${LINE}\" | grep -E -v \"([[:space:]]|^)#\"`" ] && continue
 
         # Skip the non-MD line
         [ "$(echo ${LINE} | cut -d, -f 2)" != "${MD_MARKER}" ] && continue
@@ -386,7 +386,7 @@ construct_mdadm_cmdline() {
                         fi
 
                         # Construct the teardown command line
-                        mdadm_cmd="(cat /proc/mdstat | egrep \"^md[[:digit:]]\" |"
+                        mdadm_cmd="(cat /proc/mdstat | grep -E \"^md[[:digit:]]\" |"
                         mdadm_cmd=${mdadm_cmd}" while read md rest; do ${MDADM} -S /dev/\$md; done)"
                     else
                         # Construct the remove command line
diff --git a/lustre/scripts/lc_net.in b/lustre/scripts/lc_net.in
index 51f3c43541..e749eda98a 100644
--- a/lustre/scripts/lc_net.in
+++ b/lustre/scripts/lc_net.in
@@ -170,7 +170,7 @@ remote_check() {
 
 	# Get the IP address of ${HOST_NAMES[i]} from its own ping
 	ip_pattern="[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}"
-	ip_addr=`echo "${ret_str}" | egrep -m 1 -o "${ip_pattern}"`
+	ip_addr=`echo "${ret_str}" | grep -E -m 1 -o "${ip_pattern}"`
 
 	# Compare IP addresses
 	# Check whether ${HOST_NAMES[i]} agrees with the local host
diff --git a/lustre/scripts/lc_servip b/lustre/scripts/lc_servip
index 98b99a184f..90ba8f5578 100644
--- a/lustre/scripts/lc_servip
+++ b/lustre/scripts/lc_servip
@@ -205,7 +205,7 @@ check_srvIPaddr() {
 	declare hostname=$2
 
 	# Get the corresponding IP address of the hostname from /etc/hosts table
-	real_IPaddr=`egrep "[[:space:]]$hostname([[:space:]]|$)" /etc/hosts \
+	real_IPaddr=`grep -E "[[:space:]]$hostname([[:space:]]|$)" /etc/hosts \
                      | awk '{print $1}'`
         if [ -z "$real_IPaddr" ]; then
                 echo >&2 "`basename $0`: Hostname $hostname does not exist in" \
diff --git a/lustre/scripts/lnet.in b/lustre/scripts/lnet.in
index 84409eb901..7d9bd63d4f 100644
--- a/lustre/scripts/lnet.in
+++ b/lustre/scripts/lnet.in
@@ -75,7 +75,7 @@ status ()
 	# 151 - health_check unhealthy
 	# 152 - LBUG
 	RETVAL=3
-	egrep -q "lnet" /proc/modules && STATE="loaded"
+	grep -E -q "lnet" /proc/modules && STATE="loaded"
 
 	# check for any routes - on a portals router this is the only thing
 	VAR=$(lctl get_param -n routes 2>&1)
diff --git a/lustre/scripts/lustre b/lustre/scripts/lustre
index a615b7433c..f32692c081 100644
--- a/lustre/scripts/lustre
+++ b/lustre/scripts/lustre
@@ -614,7 +614,7 @@ health_check ()
 	# 151 - health_check unhealthy
 	# 152 - LBUG
 	RETVAL=3
-	egrep -q "libcfs|lvfs|portals" /proc/modules && STATE="loaded"
+	grep -E -q "libcfs|lvfs|portals" /proc/modules && STATE="loaded"
 
 	# check for any configured devices (may indicate partial startup)
 	VAR=$(lctl get_param version 2>&1)
diff --git a/lustre/scripts/lustre_req_history b/lustre/scripts/lustre_req_history
index e0d4681874..0d0b1c38fe 100644
--- a/lustre/scripts/lustre_req_history
+++ b/lustre/scripts/lustre_req_history
@@ -36,7 +36,7 @@ fi
 
 tempip=`lctl list_nids | cut -d "@" -f1`
 
-echo $tempip | egrep '[0-9]+\.[0-9]+\.[0-9]+\.[0-9]+'
+echo $tempip | grep -E '[0-9]+\.[0-9]+\.[0-9]+\.[0-9]+'
 if [ $? -ne 0 ] ; then
         CLIENT=`host $tempip | cut -d" " -f4`
 else
diff --git a/lustre/tests/conf-sanity.sh b/lustre/tests/conf-sanity.sh
index 5a42388945..69f96696ca 100755
--- a/lustre/tests/conf-sanity.sh
+++ b/lustre/tests/conf-sanity.sh
@@ -298,7 +298,7 @@ test_5g() {
 	[ "$CLIENT_VERSION" -lt $(version_code 2.9.53) ] &&
 		skip "automount of debugfs missing before 2.9.53"
 	umount /sys/kernel/debug
-	$LCTL get_param -n devices | egrep -v "error" && \
+	$LCTL get_param -n devices | grep -E -v "error" &&
 		error "lctl can't access debugfs data"
 	grep " debugfs " /etc/mtab || error "debugfs failed to remount"
 }
@@ -872,7 +872,7 @@ test_26() {
 	do_facet $SINGLEMDS "$LCTL set_param fail_loc=0x80000135"
 	start_mds && error "MDS started but should not have started"
 	$LCTL get_param -n devices
-	DEVS=$($LCTL get_param -n devices | egrep -v MG | wc -l)
+	DEVS=$($LCTL get_param -n devices | grep -E -v MG | wc -l)
 	[ $DEVS -gt 0 ] && error "number of devices is $DEVS, should be zero"
 	# start mds to drop writeconf setting
 	start_mds || error "Unable to start MDS"
@@ -1195,7 +1195,7 @@ test_30b() {
 	# field. Hopefully that's not already a failover address for an existing
 	# node, but if so try again until it is an unused NID for this cluster.
 	local ostnid=$(do_facet ost1 "$LCTL list_nids | tail -1")
-	local origval=$(echo $ostnid | egrep -oi "[0-9a-f]*@")
+	local origval=$(echo $ostnid | grep -E -oi "[0-9a-f]*@")
 	# this will match on first loop, but keeps fake NID logic in one place
 	local newnid=$ostnid
 
@@ -3908,7 +3908,7 @@ test_39() {
 	PTLDEBUG=+malloc
 	setup
 	cleanup || error "cleanup failed with $?"
-	perl $SRCDIR/leak_finder.pl $TMP/debug 2>&1 | egrep '*** Leak:' &&
+	perl $SRCDIR/leak_finder.pl $TMP/debug 2>&1 | grep -E '*** Leak:' &&
 		error "memory leak detected" || true
 }
 run_test 39 "leak_finder recognizes both LUSTRE and LNET malloc messages"
@@ -10149,7 +10149,7 @@ test_115() {
 	local dbfs_ver=$(do_facet mds1 $DEBUGFS -V 2>&1)
 
 	echo "debugfs version: $dbfs_ver"
-	echo "$dbfs_ver" | egrep -w "1.44.3.wc1|1.44.5.wc1|1.45.2.wc1" &&
+	echo "$dbfs_ver" | grep -E -w "1.44.3.wc1|1.44.5.wc1|1.45.2.wc1" &&
 		skip_env "This version of debugfs doesn't show inode number"
 
 	local IMAGESIZE=$((3072 << 30)) # 3072 GiB
diff --git a/lustre/tests/dom-performance.sh b/lustre/tests/dom-performance.sh
index 8e2ef09faf..beceaee484 100644
--- a/lustre/tests/dom-performance.sh
+++ b/lustre/tests/dom-performance.sh
@@ -265,7 +265,7 @@ run_Dbench() {
 		return 0
 	fi
 
-	dp_run_cmd "dbench -D $TDIR $DP_NUM | egrep -v 'warmup|execute'"
+	dp_run_cmd "dbench -D $TDIR $DP_NUM | grep -E -v 'warmup|execute'"
 	if [ ${PIPESTATUS[0]} != 0 ]; then
 		error "Dbench failed, aborting"
 	fi
diff --git a/lustre/tests/ost-pools.sh b/lustre/tests/ost-pools.sh
index bc23341c80..751b886a9f 100755
--- a/lustre/tests/ost-pools.sh
+++ b/lustre/tests/ost-pools.sh
@@ -1939,7 +1939,7 @@ test_32() { # LU-15707
 	$LFS setstripe -p ignore $DIR/$tdir/$tfile ||
 		error "setstripe fail on $DIR/$tdir/$tfile"
 
-	! ( $LFS getstripe -p $DIR/$tdir/$tfile | egrep -q "[^ ]+" ) ||
+	! ( $LFS getstripe -p $DIR/$tdir/$tfile | grep -E -q "[^ ]+" ) ||
 		error "fail to create $DIR/$tdir/$tfile without pool"
 
 	# Test with start index
diff --git a/lustre/tests/posix/posix.cfg b/lustre/tests/posix/posix.cfg
index 13fcebd8c8..07c4b7d4bb 100644
--- a/lustre/tests/posix/posix.cfg
+++ b/lustre/tests/posix/posix.cfg
@@ -98,9 +98,9 @@ prep() {
     [[ -f $TEST_BIN ]] && rm -f $TEST_BIN
     [[ -d $INSTALL_DIR ]] && rm -rf $INSTALL_DIR
 
-	if egrep -q "CentOS|Red Hat|Fedora" /etc/redhat-release; then
+	if grep -E -q "CentOS|Red Hat|Fedora" /etc/redhat-release; then
 		local prefix=/usr/lib/$(uname -m)-redhat-linux5E
-		if egrep -q "Fedora" /etc/issue; then
+		if grep -E -q "Fedora" /etc/issue; then
 			prefix=/usr/arm-gp2x-linux
 		fi
 		if grep -q "el7" <<<$(uname -r); then
diff --git a/lustre/tests/racer/file_exec.sh b/lustre/tests/racer/file_exec.sh
index 3a6df15c9e..5e9b9fc813 100755
--- a/lustre/tests/racer/file_exec.sh
+++ b/lustre/tests/racer/file_exec.sh
@@ -13,6 +13,6 @@ while /bin/true ; do
 	cp -p $PROG $DIR/$file > /dev/null 2>&1
 	$DIR/$file 0.$((RANDOM % 5 + 1)) 2> /dev/null
 	sleep $((RANDOM % 3))
-done 2>&1 | egrep -v "Segmentation fault|Bus error"
+done 2>&1 | grep -E -v "Segmentation fault|Bus error"
 
 export LANG=$org_LANG
diff --git a/lustre/tests/recovery-small.sh b/lustre/tests/recovery-small.sh
index f233599ace..cb0a4e25d7 100755
--- a/lustre/tests/recovery-small.sh
+++ b/lustre/tests/recovery-small.sh
@@ -583,7 +583,8 @@ test_18a() {
 
 	do_facet client cp $TMP/$tfile $f
 	sync
-	local osc2dev=`lctl get_param -n devices | grep ${ost2_svc}-osc- | egrep -v 'MDT' | awk '{print $1}'`
+	local osc2dev=$($LCTL get_param -n devices | grep ${ost2_svc}-osc- |
+			grep -E -v 'MDT' | awk '{print $1}')
 	$LCTL --device $osc2dev deactivate || return 3
 	# my understanding is that there should be nothing in the page
 	# cache after the client reconnects?
@@ -1354,7 +1355,7 @@ test_54() {
 	cat $DIR2/$tfile.missing # save transno = 0, rc != 0 into last_rcvd
 	fail $SINGLEMDS
 	umount $MOUNT2
-	ERROR=$(dmesg | egrep "(test 54|went back in time)" | tail -n1 |
+	ERROR=$(dmesg | grep -E "(test 54|went back in time)" | tail -n1 |
 		grep "went back in time")
 	[ x"$ERROR" == x ] || error "back in time occured"
 }
diff --git a/lustre/tests/sanity-hsm.sh b/lustre/tests/sanity-hsm.sh
index 7a06515381..ebcd5fff01 100755
--- a/lustre/tests/sanity-hsm.sh
+++ b/lustre/tests/sanity-hsm.sh
@@ -417,7 +417,7 @@ wait_all_done() {
 
 	local cmd="$LCTL get_param -n $HSM_PARAM.actions"
 	[[ -n $fid ]] && cmd+=" | grep '$fid'"
-	cmd+=" | egrep 'WAITING|STARTED'"
+	cmd+=" | grep -E 'WAITING|STARTED'"
 
 	wait_update_facet --verbose mds1 "$cmd" "" $timeout ||
 		error "requests did not complete"
diff --git a/lustre/tests/sanity-lnet.sh b/lustre/tests/sanity-lnet.sh
index 3f19d2dbf0..7b9f599cd1 100755
--- a/lustre/tests/sanity-lnet.sh
+++ b/lustre/tests/sanity-lnet.sh
@@ -2353,7 +2353,7 @@ run_test 203 "add a network using an interface in the non-default namespace"
 
 LNET_PARAMS_FILE="$TMP/$TESTSUITE.parameters"
 function save_lnet_params() {
-	$LNETCTL global show | egrep -v '^global:$' |
+	$LNETCTL global show | grep -E -v '^global:$' |
 			       sed 's/://' > $LNET_PARAMS_FILE
 }
 
@@ -2630,7 +2630,7 @@ setup_health_test() {
 
 	$LNETCTL net show
 
-	$LNETCTL peer show -v 2 | egrep -e nid -e health
+	$LNETCTL peer show -v 2 | grep -E -e nid -e health
 
 	$LCTL set_param debug=+net
 
@@ -3387,7 +3387,7 @@ get_ni_stat() {
 	local stat=$2
 
 	$LNETCTL net show -v 2 |
-		egrep -e nid -e $stat |
+		grep -E -e nid -e $stat |
 		grep -wA 1 $nid |
 		awk '/'$stat':/{print $NF}'
 }
@@ -3610,7 +3610,7 @@ test_218() {
 	del_drop_rule -a
 
 	[[ $health_recovered -ne 2 ]] &&
-		do_lnetctl net show -v 2 | egrep -e nid -e health &&
+		do_lnetctl net show -v 2 | grep -E -e nid -e health &&
 		error "Health hasn't recovered"
 
 	return 0
diff --git a/lustre/tests/sanity.sh b/lustre/tests/sanity.sh
index a6e1b0ff52..e4117efb4d 100755
--- a/lustre/tests/sanity.sh
+++ b/lustre/tests/sanity.sh
@@ -2857,7 +2857,7 @@ test_27H() {
 	dd if=/dev/zero of=$DIR/$tdir/$tfile bs=4k count=4 || error "dd failed"
 	$LFS getstripe -y $DIR/$tdir/$tfile
 	(( $($LFS getstripe -y $DIR/$tdir/$tfile |
-	     egrep -c "l_ost_idx: [02]$") == "2" )) ||
+	     grep -E -c "l_ost_idx: [02]$") == "2" )) ||
 		error "expected l_ost_idx: [02]$ not matched"
 
 	# make sure ost list has been cleared
@@ -6673,7 +6673,7 @@ test_52a() {
 					error "link worked"
 	echo foo >> $DIR/$tdir/foo || error "append foo failed"
 	mrename $DIR/$tdir/foo $DIR/$tdir/foo_ren && error "rename worked"
-	lsattr $DIR/$tdir/foo | egrep -q "^-+a[-e]+ $DIR/$tdir/foo" ||
+	lsattr $DIR/$tdir/foo | grep -E -q "^-+a[-e]+ $DIR/$tdir/foo" ||
 						     error "lsattr"
 	chattr -a $DIR/$tdir/foo || error "chattr -a failed"
 	cp -r $DIR/$tdir $TMP/
@@ -6695,7 +6695,7 @@ test_52b() {
 	mrename $DIR/$tdir/foo $DIR/$tdir/foo_ren && error "rename worked"
 	[ -f $DIR/$tdir/foo ] || error "$tdir/foo is not a file"
 	[ -f $DIR/$tdir/foo_ren ] && error "$tdir/foo_ren is not a file"
-	lsattr $DIR/$tdir/foo | egrep -q "^-+i[-e]+ $DIR/$tdir/foo" ||
+	lsattr $DIR/$tdir/foo | grep -E -q "^-+i[-e]+ $DIR/$tdir/foo" ||
 							error "lsattr"
 	chattr -i $DIR/$tdir/foo || error "chattr failed"
 
@@ -6947,17 +6947,17 @@ test_56a() {
 	[[ $numcomp == 0 ]] && numcomp=1
 
 	# test lfs getstripe with --recursive
-	local filenum=$($LFS getstripe -r $dir | egrep -c "obdidx|l_ost_idx")
+	local filenum=$($LFS getstripe -r $dir | grep -E -c "obdidx|l_ost_idx")
 
 	[[ $filenum -eq $((numfiles * 2)) ]] ||
 		error "$LFS getstripe -r: found $filenum != $((numfiles * 2))"
-	filenum=$($LFS getstripe $dir | egrep -c "obdidx|l_ost_idx")
+	filenum=$($LFS getstripe $dir | grep -E -c "obdidx|l_ost_idx")
 	[[ $filenum -eq $numfiles ]] ||
 		error "$LFS getstripe $dir: found $filenum, not $numfiles"
 	echo "$LFS getstripe showed obdidx or l_ost_idx"
 
 	# test lfs getstripe with file instead of dir
-	filenum=$($LFS getstripe $dir/file1 | egrep -c "obdidx|l_ost_idx")
+	filenum=$($LFS getstripe $dir/file1 | grep -E -c "obdidx|l_ost_idx")
 	[[ $filenum -eq 1 ]] ||
 		error "$LFS getstripe $dir/file1: found $filenum, not 1"
 	echo "$LFS getstripe file1 passed"
@@ -18024,7 +18024,7 @@ test_133f() {
 	local proc_dirs=$(eval \ls -d $proc_regexp 2>/dev/null)
 	local skipped_params='force_lbug|changelog_mask|daemon_file'
 	$LCTL list_param -FR '*' | grep '=' | tr -d = |
-		egrep -v "$skipped_params" |
+		grep -E -v "$skipped_params" |
 		xargs -n 1 find $proc_dirs -name |
 		xargs -n 1 badarea_io ||
 		error "client badarea_io failed"
@@ -18052,7 +18052,7 @@ test_133g() {
 		fi
 		if [ $facet_ver -ge $(version_code 2.5.54) ]; then
 			do_facet $facet "$LCTL list_param -FR '*' | grep '=' |
-				tr -d = | egrep -v $skipped_params |
+				tr -d = | grep -E -v $skipped_params |
 				xargs -n 1 find $proc_dirs_str -name |
 				xargs -n 1 badarea_io" ||
 					error "$facet badarea_io failed"
@@ -21960,7 +21960,7 @@ test_172() {
 	umount $MOUNT || error "umount $MOUNT failed"
 	stack_trap "mount_client $MOUNT"
 
-	(( $($LCTL dl | egrep -c " osc | lov | lmv | mdc ") > 0 )) ||
+	(( $($LCTL dl | grep -E -c " osc | lov | lmv | mdc ") > 0 )) ||
 		error "no client OBDs are remained"
 
 	$LCTL dl | while read devno state type name foo; do
@@ -21975,8 +21975,8 @@ test_172() {
 		esac
 	done
 
-	if (( $($LCTL dl | egrep -c " osc | lov | lmv | mdc ") > 0 )); then
-		$LCTL dl | egrep " osc | lov | lmv | mdc "
+	if (( $($LCTL dl | grep -E -c " osc | lov | lmv | mdc ") > 0 )); then
+		$LCTL dl | grep -E " osc | lov | lmv | mdc "
 		error "some client OBDs are still remained"
 	fi
 
@@ -23617,7 +23617,8 @@ check_lnet_proc_stats() {
 	local l=$(cat "$TMP/lnet_$1" |wc -l)
 	[ $l = 1 ] || (cat "$TMP/lnet_$1" && error "$2 is not of 1 line: $l")
 
-	grep -E "$3" "$TMP/lnet_$1" || (cat "$TMP/lnet_$1" && error "$2 misformatted")
+	grep -E "$3" "$TMP/lnet_$1" ||
+		(cat "$TMP/lnet_$1" && error "$2 misformatted")
 }
 
 # uses 1st arg as trailing part of filename, 2nd arg as description for reports,
@@ -26310,12 +26311,12 @@ test_248a() {
 	# small read with fast read enabled
 	$LCTL set_param -n llite.*.fast_read=1
 	local t_fast=$(dd if=$DIR/$tfile of=/dev/null bs=4k 2>&1 |
-		egrep -o '([[:digit:]\.\,e-]+) s' | cut -d's' -f1 |
+		grep -E -o '([[:digit:]\.\,e-]+) s' | cut -d's' -f1 |
 		sed -e 's/,/./' -e 's/[eE]+*/\*10\^/')
 	# small read with fast read disabled
 	$LCTL set_param -n llite.*.fast_read=0
 	local t_slow=$(dd if=$DIR/$tfile of=/dev/null bs=4k 2>&1 |
-		egrep -o '([[:digit:]\.\,e-]+) s' | cut -d's' -f1 |
+		grep -E -o '([[:digit:]\.\,e-]+) s' | cut -d's' -f1 |
 		sed -e 's/,/./' -e 's/[eE]+*/\*10\^/')
 
 	# verify that fast read is 4 times faster for cache read
@@ -26329,13 +26330,13 @@ test_248a() {
 	# 1k non-cache read
 	cancel_lru_locks osc
 	local t_1k=$(dd if=$DIR/$tfile of=/dev/null bs=1k 2>&1 |
-		egrep -o '([[:digit:]\.\,e-]+) s' | cut -d's' -f1 |
+		grep -E -o '([[:digit:]\.\,e-]+) s' | cut -d's' -f1 |
 		sed -e 's/,/./' -e 's/[eE]+*/\*10\^/')
 
 	# 1M non-cache read
 	cancel_lru_locks osc
 	local t_1m=$(dd if=$DIR/$tfile of=/dev/null bs=1k 2>&1 |
-		egrep -o '([[:digit:]\.\,e-]+) s' | cut -d's' -f1 |
+		grep -E -o '([[:digit:]\.\,e-]+) s' | cut -d's' -f1 |
 		sed -e 's/,/./' -e 's/[eE]+*/\*10\^/')
 
 	# verify that big IO is not 4 times faster than small IO
diff --git a/lustre/tests/sanityn.sh b/lustre/tests/sanityn.sh
index 70ebba9a6a..6c494f79ac 100755
--- a/lustre/tests/sanityn.sh
+++ b/lustre/tests/sanityn.sh
@@ -5312,8 +5312,10 @@ wait_policy_state() {
 	for time in {1..60}; do
 		local nbr_started
 
-		nbr_started=$(do_facet mds1 $LCTL get_param mds.MDS.mdt.nrs_policies |
-			egrep -A2 "name: ${policy}$" | grep -c "state: $state")
+		nbr_started=$(do_facet mds1 \
+			      $LCTL get_param mds.MDS.mdt.nrs_policies |
+			      grep -E -A2 "name: ${policy}$" |
+			      grep -c "state: $state")
 
 		[[ "$nbr_started" != 2 ]] || return 0
 		sleep 1
diff --git a/lustre/tests/setup_kerberos.sh b/lustre/tests/setup_kerberos.sh
index cbe75fd30e..d53914eea8 100755
--- a/lustre/tests/setup_kerberos.sh
+++ b/lustre/tests/setup_kerberos.sh
@@ -487,7 +487,8 @@ cfg_libgssapi() {
 			grep libgssapi_krb5.so | head -n1)
 
 		if ! do_node_mute $node \
-	"egrep -q \\\"^$krb5_lib|^$(basename $krb5_lib)\\\" $GSSAPI_MECH_CONF"; then
+		     "grep -E -q \\\"^$krb5_lib|^$(basename $krb5_lib)\\\" \
+		     $GSSAPI_MECH_CONF"; then
 			do_node_mute $node \
 			"echo '$krb5_lib mechglue_internal_krb5_init' >> $GSSAPI_MECH_CONF"
 		fi
diff --git a/lustre/tests/test-framework.sh b/lustre/tests/test-framework.sh
index 91fa67f589..fe9810955b 100755
--- a/lustre/tests/test-framework.sh
+++ b/lustre/tests/test-framework.sh
@@ -131,7 +131,7 @@ print_summary () {
 		if [ -f $log ]; then
 			skipped=$(grep excluded $log |
 				awk '{ printf " %s", $3 }' | sed 's/test_//g')
-			slow=$(egrep "^PASS|^FAIL" $log |
+			slow=$(grep -E "^PASS|^FAIL" $log |
 				tr -d "("| sed s/s\)$//g | sort -nr -k 3 |
 				head -n5 |  awk '{ print $2":"$3"s" }')
 			total=$(grep duration $log | awk '{ print $2 }')
@@ -139,7 +139,7 @@ print_summary () {
 				status=Done
 			fi
 			if $DDETAILS; then
-				local durations=$(egrep "^PASS|^FAIL" $log |
+				local durations=$(grep -E "^PASS|^FAIL" $log |
 					tr -d "("| sed s/s\)$//g |
 					awk '{ print $2":"$3"|" }')
 				details=$(printf "%s\n%s %s %s\n" "$details" \
@@ -802,7 +802,7 @@ lustre_build_version_node() {
 		ver=$(do_node $node "$LCTL --version 2>/dev/null" |
 		      cut -d' ' -f2)
 	fi
-	local lver=$(egrep -i "lustre: |version: " <<<"$ver" | head -n 1)
+	local lver=$(grep -E -i "lustre: |version: " <<<"$ver" | head -n 1)
 	[ -n "$lver" ] && ver="$lver"
 
 	lver=$(sed -e 's/[^:]*: //' -e 's/^v//' -e 's/[ -].*//' <<<$ver |
@@ -1247,8 +1247,8 @@ load_modules () {
 
 check_mem_leak () {
 	LEAK_LUSTRE=$(dmesg | tail -n 30 | grep "obd_memory.*leaked" || true)
-	LEAK_PORTALS=$(dmesg | tail -n 20 | egrep -i "libcfs.*memory leaked" ||
-		true)
+	LEAK_PORTALS=$(dmesg | tail -n 20 |
+		       grep -E -i "libcfs.*memory leaked" || true)
 	if [ "$LEAK_LUSTRE" -o "$LEAK_PORTALS" ]; then
 		echo "$LEAK_LUSTRE" 1>&2
 		echo "$LEAK_PORTALS" 1>&2
@@ -7608,7 +7608,7 @@ complete_test() {
 	local duration=$1
 
 	banner "test complete, duration $duration sec"
-	[ -f "$TESTSUITELOG" ] && egrep .FAIL $TESTSUITELOG || true
+	[ -f "$TESTSUITELOG" ] && grep -E .FAIL $TESTSUITELOG || true
 	echo "duration $duration" >>$TESTSUITELOG
 }
 
@@ -8819,7 +8819,7 @@ _wait_import_state () {
 	local i=0
 
 	CONN_STATE=$($LCTL get_param -n $CONN_PROC 2>/dev/null | cut -f2 | uniq)
-	while ! echo "${CONN_STATE}" | egrep -q "^${expected}\$" ; do
+	while ! echo "${CONN_STATE}" | grep -E -q "^${expected}\$" ; do
 		if [[ "${expected}" == "DISCONN" ]]; then
 			# for disconn we can check after proc entry is removed
 			[[ -z "${CONN_STATE}" ]] && return 0

</pre>
</body>
</html>
